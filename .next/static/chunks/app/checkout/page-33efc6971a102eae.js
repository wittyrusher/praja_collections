(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[285],{6739:function(e,t,r){Promise.resolve().then(r.bind(r,8296))},8296:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return j}});var a=r(7437),s=r(2265),n=r(9376),i=r(605),c=r(6059),o=r(2827),l=r(6334);function d(e){let{onSubmit:t,isLoading:r}=e,[n,i]=(0,s.useState)({name:"",phone:"",street:"",city:"",state:"",pincode:"",country:"India"}),[c,d]=(0,s.useState)({}),m=e=>{let{name:t,value:r}=e.target;i(e=>({...e,[t]:r})),c[t]&&d(e=>({...e,[t]:""}))},u=()=>{let e={};return n.name.trim()||(e.name="Name is required"),n.phone.trim()?/^[6-9]\d{9}$/.test(n.phone)||(e.phone="Invalid phone number"):e.phone="Phone is required",n.street.trim()||(e.street="Address is required"),n.city.trim()||(e.city="City is required"),n.state.trim()||(e.state="State is required"),n.pincode.trim()?/^\d{6}$/.test(n.pincode)||(e.pincode="Invalid pincode"):e.pincode="Pincode is required",d(e),0===Object.keys(e).length};return(0,a.jsxs)("form",{onSubmit:e=>{e.preventDefault(),u()&&t(n)},className:"space-y-4",children:[(0,a.jsx)("h2",{className:"text-xl font-bold mb-4",children:"Shipping Address"}),(0,a.jsx)(o.Z,{label:"Full Name",name:"name",value:n.name,onChange:m,error:c.name,required:!0}),(0,a.jsx)(o.Z,{label:"Phone Number",name:"phone",type:"tel",value:n.phone,onChange:m,error:c.phone,placeholder:"10-digit mobile number",required:!0}),(0,a.jsx)(o.Z,{label:"Street Address",name:"street",value:n.street,onChange:m,error:c.street,required:!0}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsx)(o.Z,{label:"City",name:"city",value:n.city,onChange:m,error:c.city,required:!0}),(0,a.jsx)(o.Z,{label:"State",name:"state",value:n.state,onChange:m,error:c.state,required:!0})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsx)(o.Z,{label:"Pincode",name:"pincode",value:n.pincode,onChange:m,error:c.pincode,placeholder:"6-digit pincode",required:!0}),(0,a.jsx)(o.Z,{label:"Country",name:"country",value:n.country,onChange:m,disabled:!0})]}),(0,a.jsx)(l.Z,{type:"submit",className:"w-full",isLoading:r,children:"Continue to Payment"})]})}var m=r(8363),u=r.n(m),p=r(257);if(!p.env.RAZORPAY_KEY_ID||!p.env.RAZORPAY_KEY_SECRET)throw Error("Razorpay keys are not defined in environment variables");new(u())({key_id:p.env.RAZORPAY_KEY_ID,key_secret:p.env.RAZORPAY_KEY_SECRET});let h=p.env.RAZORPAY_KEY_ID;var x=r(9064);function y(e){let{amount:t,orderId:r,onSuccess:n,disabled:i}=e,[c,o]=s.useState(!1),d=async()=>{try{o(!0);let e=await fetch("/api/payment/create-order",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({amount:t})}),r=await e.json();if(!r.success)throw Error(r.error||"Failed to create order");if(!window.Razorpay)throw Error("Razorpay SDK not loaded");let a={key:h,amount:r.amount,currency:r.currency,name:"Praja Collections",description:"Order Payment",order_id:r.orderId,handler:function(e){n(e.razorpay_payment_id,e.razorpay_signature)},prefill:{name:"",email:"",contact:""},theme:{color:"#DC2626"},modal:{ondismiss:function(){o(!1),x.ZP.error("Payment cancelled")}}},s=new window.Razorpay(a);s.on("payment.failed",function(e){o(!1),x.ZP.error("Payment failed: "+e.error.description)}),s.open()}catch(e){o(!1),x.ZP.error(e.message||"Payment initialization failed")}};return(0,a.jsxs)(l.Z,{onClick:d,disabled:i||c,isLoading:c,className:"w-full",children:["Pay â‚¹",t.toLocaleString("en-IN")]})}var f=r(2746),g=r(1215);function j(){let{data:e,status:t}=(0,i.useSession)(),{cart:r,clearCart:o}=(0,c.j)(),l=(0,n.useRouter)(),[m,u]=(0,s.useState)(null),[p,h]=(0,s.useState)(!1),[j,b]=(0,s.useState)(null),[N,v]=(0,s.useState)(null);if("loading"===t)return(0,a.jsx)(g.Z,{text:"Loading..."});if(!e)return l.push("/login?redirect=/checkout"),null;if(0===r.items.length)return l.push("/cart"),null;let w=r.totalPrice,P=w>999?0:50,C=.18*w,S=w+P+C,I=async e=>{u(e),h(!0);try{let t=await fetch("/api/orders",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({items:r.items.map(e=>({product:e.productId,quantity:e.quantity,price:e.price,size:e.size,color:e.color})),shippingAddress:e,razorpayOrderId:"temp_"+Date.now()})}),a=await t.json();if(!a.success)throw Error(a.error||"Failed to create order");b(a.order._id),x.ZP.success("Order created! Proceed to payment")}catch(e){x.ZP.error(e.message||"Failed to create order"),u(null)}finally{h(!1)}},q=async(e,t)=>{try{let r=await fetch("/api/payment/verify",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({razorpayOrderId:N,razorpayPaymentId:e,razorpaySignature:t,orderId:j})}),a=await r.json();if(!a.success)throw Error(a.error||"Payment verification failed");x.ZP.success("Payment successful!"),o(),l.push("/orders/".concat(j))}catch(e){x.ZP.error(e.message||"Payment verification failed")}};return(0,a.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold mb-8",children:"Checkout"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[(0,a.jsx)("div",{className:"lg:col-span-2",children:(0,a.jsx)("div",{className:"bg-white rounded-lg shadow-md p-6",children:m?(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-xl font-bold mb-4",children:"Shipping Address"}),(0,a.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg mb-6",children:[(0,a.jsx)("p",{className:"font-semibold",children:m.name}),(0,a.jsx)("p",{className:"text-gray-600",children:m.phone}),(0,a.jsxs)("p",{className:"text-gray-600 mt-2",children:[m.street,", ",m.city]}),(0,a.jsxs)("p",{className:"text-gray-600",children:[m.state," - ",m.pincode]}),(0,a.jsx)("p",{className:"text-gray-600",children:m.country}),(0,a.jsx)("button",{onClick:()=>u(null),className:"text-primary-600 hover:text-primary-700 mt-2 text-sm font-medium",children:"Change Address"})]}),(0,a.jsx)("h2",{className:"text-xl font-bold mb-4",children:"Payment"}),j&&(0,a.jsx)(y,{amount:S,orderId:j,onSuccess:q})]}):(0,a.jsx)(d,{onSubmit:I,isLoading:p})})}),(0,a.jsx)("div",{className:"lg:col-span-1",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6 sticky top-24",children:[(0,a.jsx)("h2",{className:"text-xl font-bold mb-4",children:"Order Summary"}),(0,a.jsx)("div",{className:"space-y-3 mb-4 max-h-64 overflow-y-auto",children:r.items.map(e=>(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("div",{className:"relative w-16 h-16 bg-gray-100 rounded-lg overflow-hidden flex-shrink-0",children:(0,a.jsx)("img",{src:e.image||"/placeholder-product.jpg",alt:e.name,className:"w-full h-full object-cover"})}),(0,a.jsxs)("div",{className:"flex-grow",children:[(0,a.jsx)("p",{className:"text-sm font-medium line-clamp-1",children:e.name}),(0,a.jsxs)("p",{className:"text-xs text-gray-500",children:["Qty: ",e.quantity]})]}),(0,a.jsx)("p",{className:"text-sm font-semibold",children:(0,f.xG)(e.price*e.quantity)})]},e.productId))}),(0,a.jsxs)("div",{className:"border-t pt-4 space-y-2",children:[(0,a.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Subtotal"}),(0,a.jsx)("span",{className:"font-semibold",children:(0,f.xG)(w)})]}),(0,a.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Shipping"}),(0,a.jsx)("span",{className:"font-semibold",children:0===P?"FREE":(0,f.xG)(P)})]}),(0,a.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Tax (GST 18%)"}),(0,a.jsx)("span",{className:"font-semibold",children:(0,f.xG)(C)})]}),(0,a.jsxs)("div",{className:"border-t pt-2 flex justify-between text-lg font-bold",children:[(0,a.jsx)("span",{children:"Total"}),(0,a.jsx)("span",{className:"text-primary-600",children:(0,f.xG)(S)})]})]})]})})]})]})}},6334:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});var a=r(7437);function s(e){let{variant:t="primary",size:r="md",isLoading:s=!1,children:n,className:i="",disabled:c,...o}=e;return(0,a.jsx)("button",{className:"".concat("font-medium rounded-lg transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed"," ").concat({primary:"bg-primary-600 text-white hover:bg-primary-700",secondary:"bg-gray-200 text-gray-800 hover:bg-gray-300",danger:"bg-red-600 text-white hover:bg-red-700",outline:"border-2 border-primary-600 text-primary-600 hover:bg-primary-50"}[t]," ").concat({sm:"px-3 py-1.5 text-sm",md:"px-4 py-2 text-base",lg:"px-6 py-3 text-lg"}[r]," ").concat(i),disabled:c||s,...o,children:s?(0,a.jsxs)("span",{className:"flex items-center justify-center",children:[(0,a.jsxs)("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-current",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,a.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,a.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Loading..."]}):n})}r(2265)},2827:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});var a=r(7437);function s(e){let{label:t,error:r,className:s="",...n}=e;return(0,a.jsxs)("div",{className:"w-full",children:[t&&(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:t}),(0,a.jsx)("input",{className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent outline-none transition-all ".concat(r?"border-red-500":"border-gray-300"," ").concat(s),...n}),r&&(0,a.jsx)("p",{className:"mt-1 text-sm text-red-600",children:r})]})}r(2265)},1215:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});var a=r(7437);function s(e){let{size:t="md",text:r}=e;return(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center py-12",children:[(0,a.jsxs)("svg",{className:"animate-spin text-primary-600 ".concat({sm:"h-6 w-6",md:"h-12 w-12",lg:"h-16 w-16"}[t]),xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,a.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,a.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),r&&(0,a.jsx)("p",{className:"mt-4 text-gray-600",children:r})]})}r(2265)},6059:function(e,t,r){"use strict";r.d(t,{CartProvider:function(){return c},j:function(){return o}});var a=r(7437),s=r(2265),n=r(9064);let i=(0,s.createContext)(void 0);function c(e){let{children:t}=e,[r,c]=(0,s.useState)({items:[],totalItems:0,totalPrice:0});(0,s.useEffect)(()=>{let e=localStorage.getItem("cart");e&&c(JSON.parse(e))},[]),(0,s.useEffect)(()=>{localStorage.setItem("cart",JSON.stringify(r))},[r]);let o=e=>{c(t=>{let r=t.items.filter(t=>t.productId!==e),a=r.reduce((e,t)=>e+t.quantity,0),s=r.reduce((e,t)=>e+t.price*t.quantity,0);return n.Am.success("Item removed from cart"),{items:r,totalItems:a,totalPrice:s}})};return(0,a.jsx)(i.Provider,{value:{cart:r,addToCart:e=>{c(t=>{let r;t.items.find(t=>t.productId===e.productId&&t.size===e.size&&t.color===e.color)?(r=t.items.map(t=>t.productId===e.productId&&t.size===e.size&&t.color===e.color?{...t,quantity:t.quantity+e.quantity}:t),n.Am.success("Item quantity updated")):(r=[...t.items,e],n.Am.success("Item added to cart"));let a=r.reduce((e,t)=>e+t.quantity,0),s=r.reduce((e,t)=>e+t.price*t.quantity,0);return{items:r,totalItems:a,totalPrice:s}})},removeFromCart:o,updateQuantity:(e,t)=>{if(t<=0){o(e);return}c(r=>{let a=r.items.map(r=>r.productId===e?{...r,quantity:t}:r),s=a.reduce((e,t)=>e+t.quantity,0),n=a.reduce((e,t)=>e+t.price*t.quantity,0);return{items:a,totalItems:s,totalPrice:n}})},clearCart:()=>{c({items:[],totalItems:0,totalPrice:0}),n.Am.success("Cart cleared")},getCartTotal:()=>r.totalPrice},children:t})}function o(){let e=(0,s.useContext)(i);if(void 0===e)throw Error("useCart must be used within a CartProvider");return e}},2746:function(e,t,r){"use strict";r.d(t,{Et:function(){return n},p6:function(){return s},xG:function(){return a}});let a=e=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",minimumFractionDigits:0}).format(e),s=e=>new Date(e).toLocaleDateString("en-IN",{year:"numeric",month:"long",day:"numeric"}),n=(e,t)=>Math.round((e-t)/e*100)}},function(e){e.O(0,[218,64,605,491,971,117,744],function(){return e(e.s=6739)}),_N_E=e.O()}]);